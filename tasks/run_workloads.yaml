---
# ============================================================================
# STAGE: Workload Execution with Storage Re-initialization
# ============================================================================
# Runs all container workloads defined in vars/container_workloads.yaml
# Each workload triggers a complete storage lifecycle:
#   - Stop Docker
#   - Cleanup existing storage
#   - Format partition
#   - Mount partition  
#   - Configure Docker storage driver
#   - Start Docker
#   - Run benchmark with monitoring (multiple iterations)
#
# This ensures each workload starts with a clean, consistent storage state
# ============================================================================


- name: "Run workloads with storage re-initialization"
  ansible.builtin.include_tasks: tasks/run_workload_lifecycle.yaml
  loop: "{{ container_workloads }}"
  loop_control:
    loop_var: workload_item
    label: "{{ workload_item.name }}"
